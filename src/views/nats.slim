ruby:
  # https://github.com/nats-io/nats.docs/blob/master/running-a-nats-service/nats_admin/jwt.md
  api = %w{
  $JS.API.INFO
  $JS.API.STREAM.LIST
  $JS.API.STREAM.NAMES

  $JS.API.STREAM.TEMPLATE.NAMES
  $SRV.PING
  $SRV.STATS
  $SRV.INFO

  $SYS.REQ.SERVER.PING.IDZ
  $SYS.REQ.SERVER.PING.SUBZ
  $SYS.REQ.SERVER.PING.CONNZ
  $SYS.REQ.SERVER.PING.VARZ
  $SYS.REQ.SERVER.PING.JSZ
  $SYS.REQ.SERVER.PING.STATZ


  $SYS.REQ.ACCOUNT.PING.CONNZ
  $SYS.REQ.USER.INFO
  }

h2 Nats
- api.each do |a|
  h3 = a
  - msg = $nats_client.request(a).data rescue  "{}"
  pre = JSON.pretty_generate JSON(msg)

h2 Services
ruby:
  services = []
  inbox = $nats_client.new_inbox

  sub = $nats_client.subscribe inbox, & -> { services << JSON(_1.data) }

  $nats_client.publish '$SRV.PING', '', inbox
  $nats_client.publish '$SRV.STATS', '', inbox
  $nats_client.publish '$SRV.INFO', '', inbox

  sleep(3)
  sub.unsubscribe

pre = JSON.pretty_generate services

ruby:
  ## For specific service info
  #PUB $SRV.INFO.< service - name > 0
  #
  #-`$SRV.PING|STATS|INFO` - pings and retrieves status for all services
  #-`$SRV.PING|STATS|INFO.<name>` - pings or retrieves status for all services having the specified name
  #-`$SRV.PING|STATS|INFO.<name>.<id>` - pings or retrieves status of a particular service instance
